<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>All Of Me</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="All Of Me">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="All Of Me">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="All Of Me">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="All Of Me" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/12680300?v=3&amp;s=460" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Justin Yang</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Audio-Unit-变声处理/" style="font-size: 10px;">Audio Unit,变声处理</a> <a href="/tags/Cocoa-Touch-framework/" style="font-size: 10px;">Cocoa Touch,framework</a> <a href="/tags/UIScrollView-AutoLayout/" style="font-size: 10px;">UIScrollView,AutoLayout</a> <a href="/tags/lantern-http代理/" style="font-size: 10px;">lantern,http代理</a> <a href="/tags/私有库-framework/" style="font-size: 10px;">私有库,framework</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Justin Yang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars1.githubusercontent.com/u/12680300?v=3&amp;s=460" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Justin Yang</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-IOS音频变成之变声处理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/09/IOS音频变成之变声处理/" class="article-date">
  	<time datetime="2016-06-08T16:00:00.000Z" itemprop="datePublished">2016-06-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/09/IOS音频变成之变声处理/">IOS音频编程之变声处理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="IOS音频编程之变声处理"><a href="#IOS音频编程之变声处理" class="headerlink" title="IOS音频编程之变声处理"></a>IOS音频编程之变声处理</h1><h3 id="需求：耳塞Mic实时录音，变声处理后实时输出"><a href="#需求：耳塞Mic实时录音，变声处理后实时输出" class="headerlink" title="需求：耳塞Mic实时录音，变声处理后实时输出"></a>需求：耳塞Mic实时录音，变声处理后实时输出</h3><hr>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>###程序使用44100HZ的频率对原始的音频数据进行采样，并在音频输入的回调中处理采样的数据。<br>1）对AVAudioSession的一些设置</p>
<pre><code>NSError *error;
self.session = [AVAudioSession sharedInstance];
[self.session setCategory:AVAudioSessionCategoryPlayAndRecord error:&amp;error];
handleError(error);
//route变化监听
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(audioSessionRouteChangeHandle:) name:AVAudioSessionRouteChangeNotification object:self.session];

[self.session setPreferredIOBufferDuration:0.005 error:&amp;error];
handleError(error);
[self.session setPreferredSampleRate:kSmaple error:&amp;error];
handleError(error);

[self.session setActive:YES error:&amp;error];
handleError(error);
</code></pre><p> <code>setPreferredIOBufferDurations</code>文档上解释<code>change to the I/O buffer duration</code>,具体解释参看官方文档。我把它理解为在每次调用输入或输出的回调，能提供多长时间(由设置的这个值决定)的音频数据。但当我用0.005和0.93分别设置它的时候，发现回调中的<code>inNumberFrames</code>的值并未改变，一直是512，相当于每次输入或输出提供了512/44100=0.0116s的数据。（<strong>设置有问题?</strong>）</p>
<p> <code>setPreferredSampleRate</code>设置对音频数据的采样率。</p>
<p> 2)获取AudioComponentInstance</p>
<pre><code>//Obtain a RemoteIO unit instance
AudioComponentDescription acd;
acd.componentType = kAudioUnitType_Output;
acd.componentSubType = kAudioUnitSubType_RemoteIO;
acd.componentFlags = 0;
acd.componentFlagsMask = 0;
acd.componentManufacturer = kAudioUnitManufacturer_Apple;
AudioComponent inputComponent = AudioComponentFindNext(NULL, &amp;acd);
AudioComponentInstanceNew(inputComponent, &amp;_toneUnit);
</code></pre><p> 3）对AudioComponentInstance的一些初始化设置<br> <center><br>    <img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Audio/1.png" alt="I/O unit"><br> </center><br> 这张图蓝色框中的部分就是一个<code>I/O Unit</code>(<code>AudioComponentInstance</code>的实例).图中的<code>Element 0</code>连接<code>Speaker</code>,也叫<code>Output Bus</code>;<code>Element 1</code>连接<code>Mic</code>,也叫<code>Input Bus</code>.初始化它，就是对再这些Bus上的音频流的格式，设置输入输出的回调函数等。</p>
<pre><code> UInt32 enable = 1;
AudioUnitSetProperty(_toneUnit,
                     kAudioOutputUnitProperty_EnableIO,
                     kAudioUnitScope_Input,
                     kInputBus,
                     &amp;enable,
                     sizeof(enable));
AudioUnitSetProperty(_toneUnit,
                     kAudioOutputUnitProperty_EnableIO,
                     kAudioUnitScope_Output,
                     kOutoutBus, &amp;enable, sizeof(enable));

mAudioFormat.mSampleRate         = kSmaple;//采样率
mAudioFormat.mFormatID           = kAudioFormatLinearPCM;//PCM采样
mAudioFormat.mFormatFlags        = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsPacked;
mAudioFormat.mFramesPerPacket    = 1;//每个数据包多少帧
mAudioFormat.mChannelsPerFrame   = 1;//1单声道，2立体声
mAudioFormat.mBitsPerChannel     = 16;//语音每采样点占用位数
mAudioFormat.mBytesPerFrame      = mAudioFormat.mBitsPerChannel*mAudioFormat.mChannelsPerFrame/8;//每帧的bytes数
mAudioFormat.mBytesPerPacket     = mAudioFormat.mBytesPerFrame*mAudioFormat.mFramesPerPacket;//每个数据包的bytes总数，每帧的bytes数＊每个数据包的帧数
mAudioFormat.mReserved           = 0;

CheckError(AudioUnitSetProperty(_toneUnit,
                                kAudioUnitProperty_StreamFormat,
                                kAudioUnitScope_Input, kOutoutBus,
                                &amp;mAudioFormat, sizeof(mAudioFormat)),
           &quot;couldn&apos;t set the remote I/O unit&apos;s output client format&quot;);
CheckError(AudioUnitSetProperty(_toneUnit,
                                kAudioUnitProperty_StreamFormat,
                                kAudioUnitScope_Output, kInputBus,
                                &amp;mAudioFormat, sizeof(mAudioFormat)),
           &quot;couldn&apos;t set the remote I/O unit&apos;s input client format&quot;);

CheckError(AudioUnitSetProperty(_toneUnit,
                                kAudioOutputUnitProperty_SetInputCallback,
                                kAudioUnitScope_Output,
                                kInputBus,
                                &amp;_inputProc, sizeof(_inputProc)),
           &quot;couldnt set remote i/o render callback for input&quot;);

CheckError(AudioUnitSetProperty(_toneUnit,
                                kAudioUnitProperty_SetRenderCallback,
                                kAudioUnitScope_Input,
                                kOutoutBus,
                                &amp;_outputProc, sizeof(_outputProc)),
           &quot;couldnt set remote i/o render callback for output&quot;);

CheckError(AudioUnitInitialize(_toneUnit),
           &quot;couldn&apos;t initialize the remote I/O unit&quot;);
</code></pre><blockquote>
<p>注意<code>kAudioUnitScope_Output/kAudioUnitScope_Input</code>和<code>kOutput/kInput</code>的组合。设置输入输出使能时，Scope_Input下的kInput直接和Mic相连，所以是选用它们两;设置输出使能也类似。而设置音频的格式时，要选用Scope_Input下的kOutput和Scope_OutPut下的kInput,如果组合错误，为会返回-10865的错误码，意思说设置了只读属性，而在官方文档中也有说明,This hardware connection—at the input scope of element 1—is opaque to you. Your first access to audio data entering from the input hardware is at the output scope of element 1, output scope of element 0 is opaque。(<strong>疑问？在设置输入输出回调时以及Scope选择Input和Output以及Global都可以，但是官方文档中说<code>Your first access to audio data entering from the input hardware is at the output scope of element 1</code></strong>)</p>
</blockquote>
<p>##音频处理</p>
<p>###预备知识<br>变声操作实际是对声音信号的频谱进行搬移，在时域中乘以一个三角函数相当于在频域上进行了频谱的搬移。但使得频谱搬移了±𝑓。由下图傅里叶变化公式说明<br><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Audio/2.png" alt="Fourier"><br>频谱搬移后，要把搬移的F(w-w。)的部分滤除。将声音的原始PCM放到Matlab中分析出频谱，然后进行搬移(<strong>实际上，我滤波这一步是失败的，还请小伙伴们告知我应该选一个怎样的滤波器</strong>)</p>
<p>1）写一个专门手机原始声音数据的程序，将声音数据保存到模拟上(用模拟器收集的声音，方便直接将写入到沙盒中的文件拷出来)。</p>
<p>2) 将声音数据用matlab读出来(注意模拟器和matlab处理数据时的大小端，专门把数据转换读出来看了，两边都应该是小端模式)，并分析和频移其频谱<br>matlab代码</p>
<pre><code>FID=fopen(&apos;record.txt&apos;,&apos;r&apos;);
fseek(FID,0,&apos;eof&apos;);
len=ftell(FID);
frewind(FID);
A=fread(FID,len/2,&apos;short&apos;);
A=A*1.0-mean(A);
Y=fft(A);
Fs=44100;
f=Fs*(0:length(A)/2 - 1)/length(A);
subplot(211);
plot(f,abs(Y(1:length(A)/2)));
k=0:length(A)-1;
cos_y=cos(2*pi*1000*k/44100);
cos_y=cos_y&apos;;
A2=A.*cos_y;
Y2=fft(A2);
subplot(212);
plot(f,abs(Y2(1:length(A)/2)));
</code></pre><p><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Audio/3.png" alt="FFT "></p>
<p><strong>原始信号的频谱从0频开始?频率1000Hz后，虑除的就是小于1000hz的频率？实际在我的程序中对频谱只进行了200hz的搬移，那选一个大于200hz的IIR高通滤波器？</strong></p>
<p>3）用matlab设计滤波器，并得到滤波器参数.我用matlab的fdatool工具设计了一个5阶的IIR高通滤波器，截止频率为200hz。导出参数，用<code>[Bb,Ba]=sos2tf(SOS,G);</code>得出滤波器参数。</p>
<p>4）得到的Bb和Ba参数后，可以直接代入输入输出的差分方程得出滤波器的输出y(n)</p>
<p>###音频输入输出回调函数处理<br>1）输入回调</p>
<pre><code>OSStatus inputRenderTone(
                     void *inRefCon,
                     AudioUnitRenderActionFlags     *ioActionFlags,
                     const AudioTimeStamp         *inTimeStamp,
                     UInt32                         inBusNumber,
                     UInt32                         inNumberFrames,
                     AudioBufferList             *ioData)

{
ViewController *THIS=(__bridge ViewController*)inRefCon;

AudioBufferList bufferList;
bufferList.mNumberBuffers = 1;
bufferList.mBuffers[0].mData = NULL;
bufferList.mBuffers[0].mDataByteSize = 0;
OSStatus status = AudioUnitRender(THIS-&gt;_toneUnit,
                                  ioActionFlags,
                                  inTimeStamp,
                                  kInputBus,
                                  inNumberFrames,
                                  &amp;bufferList);

SInt16 *rece = (SInt16 *)bufferList.mBuffers[0].mData;
for (int i = 0; i &lt; inNumberFrames; i++) {
    rece[i] = rece[i]*THIS-&gt;_convertCos[i];//频谱搬移
}

RawData *rawData = &amp;THIS-&gt;_rawData;
//距离最大位置还有mDataByteSize/2 那就直接memcpy,否则要一个一个字节拷贝
if((rawData-&gt;rear+bufferList.mBuffers[0].mDataByteSize/2) &lt;= kRawDataLen){
    memcpy((uint8_t *)&amp;(rawData-&gt;receiveRawData[rawData-&gt;rear]), bufferList.mBuffers[0].mData, bufferList.mBuffers[0].mDataByteSize);
    rawData-&gt;rear = (rawData-&gt;rear+bufferList.mBuffers[0].mDataByteSize/2);
}else{
    uint8_t *pIOdata = (uint8_t *)bufferList.mBuffers[0].mData;
    for (int i = 0; i &lt; rawData-&gt;rear+bufferList.mBuffers[0].mDataByteSize; i+=2) {
        SInt16 data = pIOdata[i] | pIOdata[i+1]&lt;&lt;8;
        rawData-&gt;receiveRawData[rawData-&gt;rear] = data;
        rawData-&gt;rear = (rawData-&gt;rear+1)%kRawDataLen;
    }
}
return status;
}
</code></pre><blockquote>
<p>在频移的处理时，本来要对频移后的序列滤波的，<strong>但是滤波后，全部是杂音</strong>，所以删除掉了这部分代码，在提供的完整代码中有这部分删除掉的代码。存储数据中循环队列来存。</p>
</blockquote>
<p>2）输出回调</p>
<pre><code>OSStatus outputRenderTone(
                      void *inRefCon,
                      AudioUnitRenderActionFlags     *ioActionFlags,
                      const AudioTimeStamp         *inTimeStamp,
                      UInt32                         inBusNumber,
                      UInt32                         inNumberFrames,
                      AudioBufferList             *ioData)

{
ViewController *THIS=(__bridge ViewController*)inRefCon;

SInt16 *outSamplesChannelLeft   = (SInt16 *)ioData-&gt;mBuffers[0].mData;
RawData *rawData = &amp;THIS-&gt;_rawData;
for (UInt32 frameNumber = 0; frameNumber &lt; inNumberFrames; ++frameNumber) {
   if (rawData-&gt;front != rawData-&gt;rear) {
        outSamplesChannelLeft[frameNumber] = (rawData-&gt;receiveRawData[rawData-&gt;front]);
        rawData-&gt;front = (rawData-&gt;front+1)%kRawDataLen;

    }
}
return 0;
}
</code></pre><p>以上实现了对音频的实时录入变声后实时输出。没有滤波，听起来声音有点怪。😂😂😂大学的时候学的数字信号处理已经还给老师，关于信号处理这部分还请知道的小伙伴指点指点,想实现男女声音转化的效果。</p>
<p><a href="https://github.com/JustinYangJing/ConvertVoiceTest.git" target="_blank" rel="external">代码下载地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Audio-Unit-变声处理/">Audio Unit,变声处理</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-创建私有库" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/11/创建私有库/" class="article-date">
  	<time datetime="2016-02-10T16:00:00.000Z" itemprop="datePublished">2016-02-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/11/创建私有库/">创建私有库</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cocoapoads建立私有库"><a href="#Cocoapoads建立私有库" class="headerlink" title="Cocoapoads建立私有库"></a>Cocoapoads建立私有库</h1><p>该教程展示如何在github上建立自己的私有库，按照此教程也可应用在公司的git服务器上，使用pod对自己编写的库进行管理。</p>
<h2 id="在github上新建仓库"><a href="#在github上新建仓库" class="headerlink" title="在github上新建仓库"></a>在github上新建仓库</h2><ol>
<li>在github上新建MySpecs仓库(您可以命名为任意名字)，并新建<br> TestLib(您可以新建任意多个仓库，此仓库中的 工程便是您用pod<br> 管理的第三方库)仓库。</li>
<li><code>git clone https://github.com/xxxx/MySpecs.git</code>和<code>git clone https://github.com/xxxx/TestLib.git</code>(将地址换成您的仓库地址)。</li>
</ol>
<h2 id="新建库工程和podspec文件"><a href="#新建库工程和podspec文件" class="headerlink" title="新建库工程和podspec文件"></a>新建库工程和podspec文件</h2><ol>
<li><p>在上一步中clone下的<code>TestLib</code>文件夹下新建您的库工程，我使用的是新建framework,如何新建framework，请参看<a href="http://blog.csdn.net/it_yangjing/article/details/50616256" target="_blank" rel="external">这篇教程</a>(当然您可以创建其他xcode工程)<br><img style="display:block;width:80%;" src="https://github.com/JustinYangJing/Resource/blob/master/Image/1.png?raw=true" alt="img1"></p>
<p> testLib工程结构如下图<br><img style="display:block;width:80%;" src="https://github.com/JustinYangJing/Resource/blob/master/Image/2.png?raw=true" alt="img2"></p>
</li>
</ol>
<blockquote>
<p>新建编写代码后，使用<code>git</code>命令，将修改push到github上</p>
</blockquote>
<ol>
<li><p><code>Terminal</code>进入<code>TestLib</code>目录，执行<code>pod spec create TestLib</code>,将在TestLib目录下创建<code>TestLib.podspec</code>文件。<br>按照<code>TestLib.podspec</code>中的注释改写<code>TestLib.podspec</code>的内容。<br>主要改写的内容如下，您也可以点击<a href="https://github.com/JustinYangJing/TestLib" target="_blank" rel="external">此处</a>查看完整的podspec的内容</p>
<pre><code>s.name         = &quot;TestLib&quot;
  s.version      = &quot;0.0.1&quot;
  s.summary      = &quot;A short description of TestLib.&quot;
  s.description  = &lt;&lt;-DESC
           test private spec 
           DESC
  s.license      = &quot;MIT&quot;
  s.platform     = :ios, &quot;7.0&quot;
  s.source       = { :git =&gt; &quot;https://github.com/JustinYangJing/TestLib.git&quot; }
s.source_files  = &quot;TestLib/TestLib.h&quot;
  s.subspec &apos;Test&apos; do |s2|
    s2.source_files = &quot;TestLib/Test/**/*.{h,m}&quot;
  end
  s.framework  = &quot;UIKit&quot;
</code></pre><blockquote>
<p>如何编写podsepc请自行查阅相关资料</p>
</blockquote>
</li>
<li><code>TestLib.podspec</code>编写完整后，请使用<code>pod spec lint TestLib.podspec --verbose</code>命令检查<code>podspec</code>文件的有效性。根据提示消除所有错误，最后使用<code>pod spec lint TestLib.podspec --allow-warnings</code>忽略警告。</li>
<li><p>添加私有repo到CocoaPods中</p>
<pre><code>pod repo add mySpecs https://github.com/xxxx/MySpecs.git
命令格式如 pod repo add specsName specsUrl
请使用您自己的specsName和存放podspec的仓库地址
</code></pre></li>
<li><p>运行<code>./updateSpec.sh TestLib.podspec</code>脚本，该脚本的主要功能是将podspec文件copy到<code>.cocoapods/repos/mySpecs</code>下，并把修改push到github上。<a href="https://github.com/JustinYangJing/TestLib" target="_blank" rel="external">脚本详细内容</a></p>
<blockquote>
<p>您需要将脚本里的mySpecs换成您自己的specsName</p>
</blockquote>
<pre><code>该脚本先将脚本所在的文件夹中(TestLib)的修改push到github
上；
根据.podspec中的s.version中的版本，
在.cocoapods/repos/mySpecs新建或者更新版本，所以如果您
想更新版本，只需要修改s.version，脚本会自动更新repos中的
版本；
读出当前库最新的commit id,并将其写入到repos中的podspec        中，所以您修改库的代码后，运行该脚本，repos中改库的
podspec会将版本指向改库最后的一次的commit的版本；
通过脚本修改.cocoapods/repos/mySpecs的内容后，在将其
修改push到相应的github的仓库中。
</code></pre><hr>
<pre><code>例如：TestLib下的podspec文件的s.version = &quot;0.0.2&quot;,
运行该脚本后，会将TestLib中最新的修改push到github上。
并在.cocoapods/repos/mySpecs下新建(更新)
TestLib/0.0.2/TestLib.podspec文件，并且
TestLib/0.0.2/TestLib.podspec文件的source指向的是
最新TestLib的代码。
</code></pre><ol>
<li>新建私有仓库已经完成了，并向私有仓库中加入了一个TestLib的私有库。您可以通过<code>pod search TestLib</code>查看是否能搜到TestLib库。</li>
</ol>
</li>
</ol>
<h2 id="使用私有库"><a href="#使用私有库" class="headerlink" title="使用私有库"></a>使用私有库</h2><p>新建xcode工程，并新建podfile文件(如何使用cocopods管理第三方库，请上网查阅相关资料，<a href="">cocoapods官网</a>)</p>
<p>podfile内容形如</p>
<pre><code>source &apos;https://github.com/CocoaPods/Specs.git&apos;
source &apos;https://github.com/JustinYangJing/MySpecs.git&apos;
platform :ios, &quot;7.0&quot;
pod &apos;TestLib&apos;
</code></pre><p>执行<code>pod install</code>引入podfile中指定的库</p>
<blockquote>
<p>podfile默认使用”<a href="https://github.com/CocoaPods/Specs.git&quot;作为source，由于使用自己的私有仓库，所以需要手动指定各个仓库的地址。" target="_blank" rel="external">https://github.com/CocoaPods/Specs.git&quot;作为source，由于使用自己的私有仓库，所以需要手动指定各个仓库的地址。</a></p>
</blockquote>
<p><a href="https://github.com/JustinYangJing/MySpecs.git" target="_blank" rel="external">MySpecs地址</a></p>
<p><a href="https://github.com/JustinYangJing/TestLib.git" target="_blank" rel="external">TestLib地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/私有库-framework/">私有库,framework</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-lantern翻墙以及手机使用Http代理翻墙" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/10/lantern翻墙以及手机使用Http代理翻墙/" class="article-date">
  	<time datetime="2016-02-09T16:00:00.000Z" itemprop="datePublished">2016-02-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/10/lantern翻墙以及手机使用Http代理翻墙/">lantern翻墙以及手机使用Http代理翻墙</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lantern翻墙以及手机使用Http代理翻墙"><a href="#lantern翻墙以及手机使用Http代理翻墙" class="headerlink" title="lantern翻墙以及手机使用Http代理翻墙"></a>lantern翻墙以及手机使用Http代理翻墙</h1><h2 id="lantern"><a href="#lantern" class="headerlink" title="lantern"></a>lantern</h2><p>lantern是github上的一个<a href="https://github.com/getlantern/lantern" target="_blank" rel="external">开源项目</a>，支持window、Mac OS X 、Linux系统，在lantern的githup首页可下载他的安装包。Mac下安装完成，运行lantern，通过浏览器即可访问被墙的网址。</p>
<h2 id="手机通过http代理翻墙"><a href="#手机通过http代理翻墙" class="headerlink" title="手机通过http代理翻墙"></a>手机通过http代理翻墙</h2><blockquote>
<p>以下教程只适合于Mac电脑</p>
</blockquote>
<h3 id="运行以下脚本"><a href="#运行以下脚本" class="headerlink" title="运行以下脚本"></a>运行以下脚本</h3><pre><code>#!/bin/bash
#read max version for lantern.yaml
oldVersion=0
newVersion=0
lastestName=&quot;0&quot;
for name in `ls ~/Library/Application\ Support/Lantern/`; do
version=${name#*lantern-}
version=${version%%.yaml*}
if [[ $name =~ &quot;bak&quot; ]]; then
    echo -e &quot;...&quot;
else
    let newVersion=`echo ${version} | sed &quot;s:\.::g&quot;`
    if [ &quot;$newVersion&quot; -gt &quot;$oldVersion&quot; ]; then
        lastestName=${name}
        let oldVersion=newVersion
    fi
fi
done

ipaddr=`ifconfig en0 | grep &quot;inet &quot;|cut -f 2 -d &quot; &quot;`
echo -e &quot;$ipaddr:8787&quot;
`sed -i.bak &quot;s/127.0.0.1/$ipaddr/g&quot; ~/Library/Application\ Support/Lantern/Lantern/${lastestName}`
</code></pre><hr>
<p>该脚本是将<code>~/Library/Application\ Support/Lantern/</code>下最新版本<code>.yaml</code>中的<code>127.0.0.1</code>需改为Mac的IP地址。每次重新启动<code>lantern</code>,<code>.yaml</code>中的地址会被自动设置<code>127.0.0.1</code>,需要再次运行该脚本。<a href="Resource/Image/httpProx.sh">脚本下载地址</a></p>
<p>现在电脑上运行Lantern,再执行这个脚本，会在Terminal中输出形如<code>192.168.2.106:8787</code>的IP地址,在手机端设置中会用到此地址。</p>
<h3 id="手机通过通过http代理翻墙"><a href="#手机通过通过http代理翻墙" class="headerlink" title="手机通过通过http代理翻墙"></a>手机通过通过http代理翻墙</h3><blockquote>
<p>手机要和电脑在一个局域网中</p>
</blockquote>
<p>在手机端设置http代理，如iPhone手机<code>设置|Wi-Fi|所连接的wifi</code></p>
<center><br><img height="640" width="320" src="https://github.com/JustinYangJing/Resource/blob/master/Image/httpProxy.PNG?raw=true" alt="http setting"><br></center>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lantern-http代理/">lantern,http代理</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Xcode使用Cocoa Touch Framework新建Framework" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/11/Xcode使用Cocoa Touch Framework新建Framework/" class="article-date">
  	<time datetime="2016-01-10T16:00:00.000Z" itemprop="datePublished">2016-01-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/11/Xcode使用Cocoa Touch Framework新建Framework/">Xcode使用Cocoa Touch Framework新建Framework</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>网上有很多教程使用Xcode新建Framework的教程，不过使用的是Cocoa Touch Static Library，Xcode 6有一个新的功能,通过Cocoa Touch Framework。能直接生成Framework。</p>
</blockquote>
<h2 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h2><p>打开Xcode,新建工程，选择Cocoa Touch Framework,命名为xibFramework.<br><img style="display:block;width:80%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/1.png"></p>
<h2 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h2><p>1）在framework中添加类，资源等文件。<br><img style="display:block;width:50%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/2.png"></p>
<blockquote>
<p>如上图所示，在Resource中添加xib,在xibFramework.xvassets添加framework中所需要使用到的图片。</p>
</blockquote>
<p>2）在xibFramework.h中导入<code>#import &lt;xibFramework/CustomView.h&gt;</code></p>
<p><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/3.jpeg"></p>
<blockquote>
<p>xibFramework是新建framework时，自动生成的，把所有需要公开的类的头文件包含在这个.h文件中，在使用framework时，只需要导入这个.h文件即可</p>
</blockquote>
<p>3)选中<code>xibFrmework|Build Phases</code>,在<code>Headers</code>中将所有需要公开的头文件拖入<code>Public</code>中.在<code>Run Script</code>中添加<code>ios-build-framework-script.sh</code>脚本(<a href="https://github.com/JustinYangJing/Resource/blob/master/Image/Framework/ios-build-framework-script.sh" target="_blank" rel="external">下载地址</a>)。<br><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/4.jpeg"></p>
<blockquote>
<p>若<code>Build Phases</code>中没有<code>Headers</code>和<code>Run Script</code>，在右上角的+处将他们加入到<code>Bulid Phases</code>中</p>
<hr>
<p><code>shell</code>脚本的路径要写对，否则编译的时候会找不到，demo中shell脚本放在<code>xibFramework/xibFramework</code></p>
</blockquote>
<p>4)脚本解析</p>
<p>这个脚本是生成支持arm64 armv7 和i386 x86_64(i386和x86_64并为用xcodebuild命令来生成，当你选择在模拟器下编译时，会生成支持这两种架构的framework)架构的framework。该脚本只允许用户在模拟器下编译，否则会报错，生成后的framework存放在工程目录的Release-universal或者Debug-universal目录下<br><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/5.jpeg"></p>
<blockquote>
<p>到这一步，就已经生成了framework，下面对framework使用</p>
</blockquote>
<h2 id="step3"><a href="#step3" class="headerlink" title="step3"></a>step3</h2><p>1)新建工程,选择<code>Single View Application</code>，命名为<code>UseFrmeworkDemo</code></p>
<p>2)将<code>xibFramework.framework</code>拖入<br><code>UseFrmeworkDemo</code>中，并使用<code>framework</code><br><img style="display:block;width:100%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/Framework/6.jpeg"></p>
<p>选择<code>UseFrameworkDemo|General</code>,在<code>Embedded Binaries</code>和<code>Linked Frameworks and Libraries</code>中加入xibFramework，在拖入<code>xibFramework</code>时，<code>Linked Frameworks and Libraries</code>中就会加入这个<code>framework</code>.</p>
<p>3)<code>command+R</code>运行工程，可以看到<code>xibFramework</code>的控件在<code>UseFrameworkDemo</code>中能正常使用了.</p>
<hr>
<p>xibFramework <a href="https://github.com/JustinYangJing/Resource/raw/master/Image/Framework/xibFramework.zip" target="_blank" rel="external">下载地址</a></p>
<p>UseFrameworkDemo <a href="https://github.com/JustinYangJing/Resource/raw/master/Image/Framework/UseFrameworkDemo.zip" target="_blank" rel="external">下载地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cocoa-Touch-framework/">Cocoa Touch,framework</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ScrollView自动布局" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/10/ScrollView自动布局/" class="article-date">
  	<time datetime="2015-05-09T16:00:00.000Z" itemprop="datePublished">2015-05-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/10/ScrollView自动布局/">ScrollView自动布局</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="该篇文章将讲述对UIScrollView如何运用autoLayout-结合实例，根据显示的内容，自动调整scrollView的contentSize"><a href="#该篇文章将讲述对UIScrollView如何运用autoLayout-结合实例，根据显示的内容，自动调整scrollView的contentSize" class="headerlink" title="该篇文章将讲述对UIScrollView如何运用autoLayout, 结合实例，根据显示的内容，自动调整scrollView的contentSize"></a>该篇文章将讲述对UIScrollView如何运用autoLayout, 结合实例，根据显示的内容，自动调整scrollView的contentSize</h2><h3 id="新建工程"><a href="#新建工程" class="headerlink" title="新建工程"></a>新建工程</h3><h3 id="在Storyboard中的View-Controller的view中拖入一个scrollView-并在scrollView中添加一个UIView，层级关系如下图-包含所有添加的约束条件"><a href="#在Storyboard中的View-Controller的view中拖入一个scrollView-并在scrollView中添加一个UIView，层级关系如下图-包含所有添加的约束条件" class="headerlink" title="在Storyboard中的View Controller的view中拖入一个scrollView,并在scrollView中添加一个UIView，层级关系如下图(包含所有添加的约束条件)"></a>在Storyboard中的View Controller的view中拖入一个scrollView,并在scrollView中添加一个UIView，层级关系如下图(包含所有添加的约束条件)</h3><p><img style="display:block;width:80%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/ScrollViewAutoLayout/1.png" alt="constrait"></p>
<h3 id="为ScrollView-Scroll-View-和UIView-Content-View-添加限制条件"><a href="#为ScrollView-Scroll-View-和UIView-Content-View-添加限制条件" class="headerlink" title="为ScrollView(Scroll View)和UIView(Content View)添加限制条件"></a>为ScrollView(Scroll View)和UIView(Content View)添加限制条件</h3><ol>
<li>为ScrollView添加相对于父视图的上下左右约束，如下图<br><img style="display:block;width:80%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/ScrollViewAutoLayout/2.png" alt="constrait"></li>
</ol>
<blockquote>
<p>这里的约束为左右边界和父视图相等，这里虽为-16，但是scrollView的的宽度和父视图是相等的，在添加leading 和trailing限制条件的时候，取消Constrain to margins选项，leading和trailing可以为0，效果和-16一样。这四个限制条件确定了scroll view的frame</p>
</blockquote>
<ol>
<li>为Content View添加约束，如下图<br><img style="display:block;width:80%;" src="https://raw.githubusercontent.com/JustinYangJing/Resource/master/Image/ScrollViewAutoLayout/3.png" alt="constrait"></li>
</ol>
<blockquote>
<p>分别添加Content View的leading，top,bottom,trailing限制条件，设置为和父视图相等(scroll view),这里看起来是设置content view在scroll view中的frame,  苹果公司对在scroll view中添加的这四个约束做了变化，它不是确定content view的尺寸，而是确定content view对于scroll view四周的留白。</p>
<p>对content view添加width和Height的约束，scroll view的content size就是根据content view的size来确定的，所有在程序中动态改变content view的size的约束，scroll view的contentsize也会跟着动态变化（网上其他教程需要再新建一个 参照视图，将content view和参照视图的高宽设置为相等，以确定content view的高宽，这里的对content view的高宽所加的限制条件就代替了参照视图的作用）。</p>
</blockquote>
<h3 id="将Content-view的Height-Constraint限制拖入如VC中，并将Content-view拖入VC中"><a href="#将Content-view的Height-Constraint限制拖入如VC中，并将Content-view拖入VC中" class="headerlink" title="将Content view的Height Constraint限制拖入如VC中，并将Content view拖入VC中"></a>将Content view的Height Constraint限制拖入如VC中，并将Content view拖入VC中</h3><h3 id="在代码中动态改变content-view的高限制条件"><a href="#在代码中动态改变content-view的高限制条件" class="headerlink" title="在代码中动态改变content view的高限制条件"></a>在代码中动态改变content view的高限制条件</h3><pre><code>@interface ViewController ()
@property (weak, nonatomic) IBOutlet UIView *contentView;
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *heightConstraint;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.contentView.backgroundColor = [UIColor redColor];
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        self.contentView.backgroundColor = [UIColor blueColor];
        self.heightConstraint.constant = 200;
    });
}
</code></pre><blockquote>
<p>在4s的延时后，Content view的颜色改变，高的约束条件改变为200，scroll view的Contentsize 也会根据content view 当前的尺寸相应的将其Content size调整值200. 测试直接设置ContentView的frame，scrollview的Contentsize不会改变。</p>
</blockquote>
<h3 id="总结-scroll-view-添加一些控件，控件的内容从网路上取得，会根据网路上取得的内容改变控件的frame，运行scroll-view的这一特性，可以自动改变其Contentsize"><a href="#总结-scroll-view-添加一些控件，控件的内容从网路上取得，会根据网路上取得的内容改变控件的frame，运行scroll-view的这一特性，可以自动改变其Contentsize" class="headerlink" title="总结:scroll view 添加一些控件，控件的内容从网路上取得，会根据网路上取得的内容改变控件的frame，运行scroll view的这一特性，可以自动改变其Contentsize."></a>总结:scroll view 添加一些控件，控件的内容从网路上取得，会根据网路上取得的内容改变控件的frame，运行scroll view的这一特性，可以自动改变其Contentsize.</h3><p>提供两个源码例子</p>
<p>第一个例子是以上教程的源码。<a href="https://github.com/JustinYangJing/Resource/raw/master/Image/ScrollViewAutoLayout/AutoLayoutScrollView.zip" target="_blank" rel="external">下载地址</a></p>
<p>第二个例子是将contentView的改为UILabel,在延时后，增加label的text，label的frame和scroll view的contentsize都自动增加了。<a href="https://github.com/JustinYangJing/Resource/raw/master/Image/ScrollViewAutoLayout/auto.zip" target="_blank" rel="external">下载地址</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UIScrollView-AutoLayout/">UIScrollView,AutoLayout</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/blog/">blog</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Justin Yang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>